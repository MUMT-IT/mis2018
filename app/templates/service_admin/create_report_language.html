{% extends "academic_services/service_base.html" %}
{% block head %}
    {{ super() }}
{% endblock %}
{% block page_content %}
    {% include "academic_services/customer_nav.html" %}
    <section class="section">
        <div class="container">
            <div class="columns">
                <div class="column has-text-centered">
                    <h1 class="title">
                        ฟอร์ม{{ service_request.sub_lab.sub_lab }}
                    </h1>
                </div>
            </div>
            <div class="columns">
                <div class="column is-10 is-offset-1">
                    <div class="box">
                        <form method="post">
                            <input type="hidden" value="{{ csrf_token() }}" name="csrf_token">
                            <div class="field">
                                <label class="label">ใบรายงานผล</label>
                            </div>
                            <div class="field">
                                <div class="control">
                                    <label class="label">1. ภาษาไทย</label>
                                </div>
                            </div>
                            <div class="field ml-4" id="thai-options">
                                <div class="control">
                                {% for r in report_languages|sort(attribute='no') %}
                                    {% if r.language == 'ไทย' %}
                                        <label {% if r.category == 'copy' %}class="checkbox mb-2 ml-5" {% else %} class="checkbox mb-2" {% endif %}>
                                            <input id="{{ r.category }}" type="checkbox" name="check_report_language"
                                                   value="{{ r.id }}"
                                                   {% if r.id in req_report_language_id or
                                                        (sub_lab != 'บริการตรวจวิเคราะห์ผลิตภัณฑ์ในการฆ่าเชื้อไวรัส' and r.type == 'ใบรายงานผลแบบอิเล็กทรอนิกส์ไฟล์') %}
                                                        checked
                                                   {% endif %}
                                            >
                                            {{ r.type }}
                                            {% if r.price > 0 %}
                                                ราคา {{ "{:,.2f}".format(r.price) }} บาท
                                            {% endif %}
                                        </label>
                                        <br/>
                                    {% endif %}
                                {% endfor %}
                                </div>
                            </div>
                            <div class="field">
                                <div class="control">
                                     <label class="label">2. ภาษาอังกฤษ</label>
                                </div>
                            </div>
                            <div class="field ml-4" id="eng-options">
                                <div class="control">
                                    {% for r in report_languages|sort(attribute='no') %}
                                        {% if r.language == 'อังกฤษ' %}
                                            <label {% if r.category == 'copy' %}class="checkbox mb-2 ml-5" {% else %} class="checkbox mb-2" {% endif %}>
                                                <input id="{{ r.category }}" type="checkbox" name="check_report_language"
                                                       value="{{ r.id }}"
                                                       {% if r.id in req_report_language_id or
                                                            (sub_lab == 'บริการตรวจวิเคราะห์ผลิตภัณฑ์ในการฆ่าเชื้อไวรัส' and r.type == 'ใบรายงานผลแบบอิเล็กทรอนิกส์ไฟล์') %}
                                                            checked
                                                       {% endif %}
                                                >
                                                {{ r.type }}
                                                {% if r.price > 0 %}
                                                    ราคา {{ "{:,.2f}".format(r.price) }} บาท
                                                {% endif %}
                                            </label>
                                            <br/>
                                        {% endif %}
                                    {% endfor %}
                                </div>
                            </div>
                            <div class="field">
                                <div class="buttons is-centered">
                                    <button class="button is-success" type="submit" value="submit">บันทึกและดำเนินการต่อ</button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </section>
{% endblock %}
{% block scripts %}
    {{ super() }}
    <script>
        function updateDisableThaiCopy() {
            const thaiOriginals = document.querySelectorAll('#thai-options input[id^="original"]');
            const thaiCopy = document.querySelector('#thai-options input#copy');
            const anyChecked = Array.from(thaiOriginals).some(cb => cb.checked);
            thaiCopy.disabled = !anyChecked;
            if (!anyChecked) thaiCopy.checked = false;
        }

        updateDisableThaiCopy();

        document.querySelectorAll('#thai-options input[id^="original"]').forEach(function (checkbox) {
            checkbox.addEventListener("change", updateDisableThaiCopy);
        });

        function updateDisableEngCopy() {
            const engOriginals = document.querySelectorAll('#eng-options input[id^="original"]');
            const engCopy = document.querySelector('#eng-options input#copy');
            const anyChecked = Array.from(engOriginals).some(cb => cb.checked);
            engCopy.disabled = !anyChecked;
            if (!anyChecked) engCopy.checked = false;
        }

        updateDisableEngCopy();
        document.querySelectorAll('#eng-options input[id^="original"]').forEach(function (checkbox) {
            checkbox.addEventListener("change", updateDisableEngCopy);
        });
    </script>
{% endblock %}