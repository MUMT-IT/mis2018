<!DOCTYPE html>
<html lang="en">

<head>
          <meta charset="UTF-8">
          <meta name="viewport" content="width=device-width, initial-scale=1.0">
          <title>Test Google Sign-up Flow</title>
          <script src="https://accounts.google.com/gsi/client" async defer></script>
          <style>
                    body {
                              font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                              max-width: 1200px;
                              margin: 0 auto;
                              padding: 20px;
                              background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
                              min-height: 100vh;
                    }

                    .test-container {
                              background: white;
                              border-radius: 16px;
                              padding: 30px;
                              box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
                              margin-bottom: 20px;
                    }

                    h1 {
                              color: #667eea;
                              margin-bottom: 10px;
                    }

                    h2 {
                              color: #764ba2;
                              margin-top: 30px;
                              margin-bottom: 15px;
                    }

                    .test-section {
                              background: #f8f9fa;
                              border-left: 4px solid #667eea;
                              padding: 15px;
                              margin: 15px 0;
                              border-radius: 4px;
                    }

                    .test-link {
                              display: inline-block;
                              background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                              color: white;
                              padding: 12px 24px;
                              border-radius: 8px;
                              text-decoration: none;
                              margin: 10px 10px 10px 0;
                              font-weight: 600;
                              transition: transform 0.2s;
                    }

                    .test-link:hover {
                              transform: translateY(-2px);
                              box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
                    }

                    .status {
                              display: inline-block;
                              padding: 4px 12px;
                              border-radius: 12px;
                              font-size: 0.85rem;
                              font-weight: 600;
                    }

                    .status.ready {
                              background: #d4edda;
                              color: #155724;
                    }

                    .status.pending {
                              background: #fff3cd;
                              color: #856404;
                    }

                    .code-block {
                              background: #2d2d2d;
                              color: #f8f8f2;
                              padding: 15px;
                              border-radius: 8px;
                              overflow-x: auto;
                              font-family: 'Monaco', 'Courier New', monospace;
                              font-size: 0.9rem;
                              margin: 10px 0;
                    }

                    .info-box {
                              background: #e7f3ff;
                              border: 1px solid #b3d9ff;
                              padding: 15px;
                              border-radius: 8px;
                              margin: 15px 0;
                    }

                    .google-button-container {
                              display: flex;
                              justify-content: center;
                              padding: 30px;
                              background: linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(118, 75, 162, 0.05) 100%);
                              border-radius: 12px;
                              border: 2px dashed rgba(102, 126, 234, 0.2);
                    }

                    .checklist {
                              list-style: none;
                              padding: 0;
                    }

                    .checklist li {
                              padding: 8px 0;
                              padding-left: 30px;
                              position: relative;
                    }

                    .checklist li:before {
                              content: "‚úì";
                              position: absolute;
                              left: 0;
                              color: #48c774;
                              font-weight: bold;
                              font-size: 1.2rem;
                    }

                    .warning {
                              background: #fff3cd;
                              border-left: 4px solid #ffc107;
                              padding: 15px;
                              margin: 15px 0;
                              border-radius: 4px;
                    }

                    table {
                              width: 100%;
                              border-collapse: collapse;
                              margin: 15px 0;
                    }

                    th,
                    td {
                              padding: 12px;
                              text-align: left;
                              border-bottom: 1px solid #e0e0e0;
                    }

                    th {
                              background: #667eea;
                              color: white;
                              font-weight: 600;
                    }

                    tr:hover {
                              background: #f8f9fa;
                    }
          </style>
</head>

<body>
          <div class="test-container">
                    <h1>üß™ Google Sign-up Flow Test Page</h1>
                    <p style="color: #666; margin-bottom: 20px;">
                              Test page ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏î‡πâ‡∏ß‡∏¢ Google Account
                    </p>

                    <div class="info-box">
                              <strong>üìã Test Checklist:</strong>
                              <ul class="checklist">
                                        <li>Database ‡∏°‡∏µ google_sub ‡πÅ‡∏•‡∏∞ google_connected_at columns</li>
                                        <li>Migration ‡∏ñ‡∏π‡∏Å apply ‡πÅ‡∏•‡πâ‡∏ß (c619f1bef360)</li>
                                        <li>Google Client ID ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÅ‡∏•‡πâ‡∏ß</li>
                                        <li>Routes ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</li>
                                        <li>Templates ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢</li>
                              </ul>
                    </div>

                    <h2>1. Test Google Sign-in Button</h2>
                    <div class="test-section">
                              <p><strong>Status:</strong> <span class="status ready">Ready to Test</span></p>
                              <p>‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° Google Sign-in ‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏î‡∏™‡∏≠‡∏ö:</p>

                              <div class="google-button-container">
                                        <div id="g_id_onload"
                                                  data-client_id="206836986017-1dctro1ehrqta2r91e5appn5j78spn9h.apps.googleusercontent.com"
                                                  data-context="signup" data-ux_mode="popup"
                                                  data-callback="handleCredentialResponse" data-auto_prompt="false">
                                        </div>
                                        <div class="g_id_signin" data-type="standard" data-shape="rectangular"
                                                  data-theme="outline" data-text="signup_with" data-size="large"
                                                  data-logo_alignment="left">
                                        </div>
                              </div>
                    </div>

                    <h2>2. Test Routes</h2>
                    <div class="test-section">
                              <table>
                                        <thead>
                                                  <tr>
                                                            <th>Route</th>
                                                            <th>Method</th>
                                                            <th>Status</th>
                                                            <th>Action</th>
                                                  </tr>
                                        </thead>
                                        <tbody>
                                                  <tr>
                                                            <td><code>/continuing_edu/register?modern=1</code></td>
                                                            <td>GET</td>
                                                            <td><span class="status ready">Ready</span></td>
                                                            <td><a href="/continuing_edu/register?lang=en&modern=1"
                                                                                class="test-link"
                                                                                target="_blank">Test</a></td>
                                                  </tr>
                                                  <tr>
                                                            <td><code>/continuing_edu/google-signup-callback</code></td>
                                                            <td>POST</td>
                                                            <td><span class="status ready">Ready</span></td>
                                                            <td>Auto-called by Google</td>
                                                  </tr>
                                                  <tr>
                                                            <td><code>/continuing_edu/complete-profile</code></td>
                                                            <td>GET/POST</td>
                                                            <td><span class="status ready">Ready</span></td>
                                                            <td>Redirected after signup</td>
                                                  </tr>
                                        </tbody>
                              </table>
                    </div>

                    <h2>3. Test Scenarios</h2>

                    <div class="test-section">
                              <h3>üü¢ Scenario 1: New User Sign-up</h3>
                              <ol>
                                        <li>‡∏Ñ‡∏•‡∏¥‡∏Å‡∏õ‡∏∏‡πà‡∏° "Sign up with Google" ‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô</li>
                                        <li>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Google Account</li>
                                        <li>‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á Member account ‡πÉ‡∏´‡∏°‡πà</li>
                                        <li>Redirect ‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ Complete Profile</li>
                                        <li>‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</li>
                                        <li>‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô!</li>
                              </ol>
                              <a href="/continuing_edu/register?lang=th&modern=1" class="test-link">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏î‡∏™‡∏≠‡∏ö
                                        (‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢)</a>
                              <a href="/continuing_edu/register?lang=en&modern=1" class="test-link">Start Test
                                        (English)</a>
                    </div>

                    <div class="test-section">
                              <h3>üü° Scenario 2: Existing User Login</h3>
                              <ol>
                                        <li>‡πÉ‡∏ä‡πâ Google Account ‡∏ó‡∏µ‡πà‡πÄ‡∏Ñ‡∏¢‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÅ‡∏•‡πâ‡∏ß</li>
                                        <li>‡∏Ñ‡∏•‡∏¥‡∏Å‡∏õ‡∏∏‡πà‡∏° "Sign in with Google"</li>
                                        <li>‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ google_sub ‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</li>
                                        <li>Login ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡πÅ‡∏•‡∏∞ redirect ‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</li>
                              </ol>
                              <a href="/continuing_edu/login?lang=th" class="test-link">‡∏ó‡∏î‡∏™‡∏≠‡∏ö Login</a>
                    </div>

                    <div class="test-section">
                              <h3>üîµ Scenario 3: Link Existing Account</h3>
                              <ol>
                                        <li>‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏°‡∏µ account ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß (email ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô)</li>
                                        <li>‡πÉ‡∏ä‡πâ Google Sign-in ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å</li>
                                        <li>‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡πÇ‡∏¢‡∏á google_sub ‡∏Å‡∏±‡∏ö account ‡πÄ‡∏î‡∏¥‡∏°</li>
                                        <li>Login ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</li>
                              </ol>
                    </div>

                    <h2>4. Database Check</h2>
                    <div class="test-section">
                              <p>‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡πâ‡∏ß ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô database:</p>
                              <div class="code-block">
                                        # ‡πÄ‡∏Ç‡πâ‡∏≤ Python shell
                                        flask shell

                                        # Query ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                                        from app.continuing_edu.models import Member
                                        from sqlalchemy import desc

                                        # ‡∏î‡∏π Member ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏î‡πâ‡∏ß‡∏¢ Google
                                        members =
                                        Member.query.filter(Member.google_sub.isnot(None)).order_by(desc(Member.created_at)).limit(5).all()

                                        for m in members:
                                        print(f"ID: {m.id}, Username: {m.username}, Email: {m.email}")
                                        print(f"Google Sub: {m.google_sub}")
                                        print(f"Connected: {m.google_connected_at}")
                                        print(f"Verified: {m.is_verified}")
                                        print("-" * 50)
                              </div>
                    </div>

                    <h2>5. Expected Results</h2>
                    <div class="test-section">
                              <h3>‚úÖ Success Indicators:</h3>
                              <ul>
                                        <li>Google popup ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å‡∏õ‡∏∏‡πà‡∏°</li>
                                        <li>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å account ‡πÅ‡∏•‡πâ‡∏ß‡πÑ‡∏°‡πà‡∏°‡∏µ error</li>
                                        <li>Redirect ‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ Complete Profile ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏´‡∏°‡πà</li>
                                        <li>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• google_sub ‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ô database</li>
                                        <li>google_connected_at ‡∏°‡∏µ‡∏Ñ‡πà‡∏≤ timestamp</li>
                                        <li>is_verified = True (Google email verified)</li>
                                        <li>Login ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡πÉ‡∏ä‡πâ Google ‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</li>
                              </ul>
                    </div>

                    <div class="warning">
                              <strong>‚ö†Ô∏è Note:</strong> Google Client ID ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡πá‡∏ô development key.
                              ‡∏ñ‡πâ‡∏≤‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á ‡∏ï‡πâ‡∏≠‡∏á:
                              <ul style="margin: 10px 0;">
                                        <li>‡∏™‡∏£‡πâ‡∏≤‡∏á Google Cloud Project ‡πÉ‡∏´‡∏°‡πà</li>
                                        <li>Enable Google Sign-In API</li>
                                        <li>‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ OAuth consent screen</li>
                                        <li>‡πÄ‡∏û‡∏¥‡πà‡∏° authorized redirect URIs</li>
                                        <li>‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï GOOGLE_CLIENT_ID ‡πÉ‡∏ô .env</li>
                              </ul>
                    </div>

                    <h2>6. Troubleshooting</h2>
                    <div class="test-section">
                              <h3>üîß Common Issues:</h3>
                              <table>
                                        <thead>
                                                  <tr>
                                                            <th>Problem</th>
                                                            <th>Solution</th>
                                                  </tr>
                                        </thead>
                                        <tbody>
                                                  <tr>
                                                            <td>Google button ‡πÑ‡∏°‡πà‡πÅ‡∏™‡∏î‡∏á</td>
                                                            <td>Check console errors, verify Google Client ID</td>
                                                  </tr>
                                                  <tr>
                                                            <td>Redirect ‡πÑ‡∏°‡πà‡∏ó‡∏≥‡∏á‡∏≤‡∏ô</td>
                                                            <td>‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö callback route ‡πÉ‡∏ô views.py</td>
                                                  </tr>
                                                  <tr>
                                                            <td>Database error</td>
                                                            <td>‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏£‡∏±‡∏ô migration ‡πÅ‡∏•‡πâ‡∏ß</td>
                                                  </tr>
                                                  <tr>
                                                            <td>JWT decode error</td>
                                                            <td>Install PyJWT: pip install PyJWT</td>
                                                  </tr>
                                        </tbody>
                              </table>
                    </div>

                    <h2>7. Manual Test Links</h2>
                    <div class="test-section">
                              <a href="/continuing_edu/register?lang=th&modern=1" class="test-link">üìù Register (Modern
                                        - Thai)</a>
                              <a href="/continuing_edu/register?lang=en&modern=1" class="test-link">üìù Register (Modern
                                        - English)</a>
                              <a href="/continuing_edu/register?lang=th" class="test-link">üìù Register (Old Version)</a>
                              <a href="/continuing_edu/login?lang=th" class="test-link">üîê Login</a>
                              <a href="/continuing_edu/?lang=th" class="test-link">üè† Home Page</a>
                    </div>
          </div>

          <script>
                    function handleCredentialResponse(response) {
                              console.log('Google Credential Response:', response);

                              // Create form and submit
                              const form = document.createElement('form');
                              form.method = 'POST';
                              form.action = '/continuing_edu/google-signup-callback?lang=en';

                              const csrfInput = document.createElement('input');
                              csrfInput.type = 'hidden';
                              csrfInput.name = 'csrf_token';
                              csrfInput.value = '{{ csrf_token() }}';

                              const credentialInput = document.createElement('input');
                              credentialInput.type = 'hidden';
                              credentialInput.name = 'credential';
                              credentialInput.value = response.credential;

                              form.appendChild(csrfInput);
                              form.appendChild(credentialInput);
                              document.body.appendChild(form);

                              console.log('Submitting form to:', form.action);
                              form.submit();
                    }

                    // Log when Google API is loaded
                    window.onload = function () {
                              console.log('Google Sign-In API loaded');
                              console.log('Client ID: 206836986017-1dctro1ehrqta2r91e5appn5j78spn9h.apps.googleusercontent.com');
                    };
          </script>
</body>

</html>