{% extends "continueing_edu/admin/base.html" %}

{% block title %}{{ event.title_en }} - Registrations{% endblock %}

{% block head %}
<style>
          .event-header {
                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                    color: white;
                    padding: 2rem;
                    border-radius: 8px;
                    margin-bottom: 2rem;
          }

          .stats-grid {
                    display: grid;
                    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
                    gap: 1rem;
                    margin-top: 1.5rem;
          }

          .stat-box {
                    background: rgba(255, 255, 255, 0.2);
                    padding: 1rem;
                    border-radius: 6px;
                    text-align: center;
          }

          .stat-box .number {
                    font-size: 2rem;
                    font-weight: bold;
          }

          .stat-box .label {
                    font-size: 0.875rem;
                    opacity: 0.9;
                    margin-top: 0.5rem;
          }

          .table-container {
                    background: white;
                    border-radius: 8px;
                    border: 1px solid #e5e7eb;
                    overflow: hidden;
          }
</style>
{% endblock %}

{% block content %}
<div class="container is-fluid">
          <nav class="breadcrumb" aria-label="breadcrumbs">
                    <ul>
                              <li><a href="{{ url_for('continuing_edu_admin.list_registrations') }}">Registrations</a>
                              </li>
                              <li><a href="{{ url_for('continuing_edu_admin.list_events') }}">Events</a></li>
                              <li class="is-active"><a href="#" aria-current="page">{{ event.title_en[:50] }}</a></li>
                    </ul>
          </nav>

          <!-- Event Header -->
          <div class="event-header">
                    <div class="level">
                              <div class="level-left">
                                        <div class="level-item">
                                                  <div>
                                                            <p class="is-size-7 has-text-weight-bold"
                                                                      style="opacity: 0.8;">
                                                                      {{ event.event_type.upper() }} #{{ event.id }}
                                                            </p>
                                                            <h1 class="title is-3 has-text-white mt-2">{{ event.title_en
                                                                      }}</h1>
                                                            {% if event.title_th %}
                                                            <p class="subtitle is-6 has-text-white mt-2">{{
                                                                      event.title_th }}</p>
                                                            {% endif %}
                                                  </div>
                                        </div>
                              </div>
                              <div class="level-right">
                                        <div class="level-item">
                                                  <div class="buttons">
                                                            <a href="{{ url_for('continuing_edu_admin.export_registrations', event_id=event.id) }}"
                                                                      class="button is-light">
                                                                      <span class="icon"><i
                                                                                          class="fas fa-download"></i></span>
                                                                      <span>Export</span>
                                                            </a>
                                                  </div>
                                        </div>
                              </div>
                    </div>

                    <!-- Statistics -->
                    <div class="stats-grid">
                              <div class="stat-box">
                                        <div class="number">{{ stats.total }}</div>
                                        <div class="label">Total</div>
                              </div>
                              <div class="stat-box">
                                        <div class="number">{{ stats.pending }}</div>
                                        <div class="label">Pending</div>
                              </div>
                              <div class="stat-box">
                                        <div class="number">{{ stats.confirmed }}</div>
                                        <div class="label">Confirmed</div>
                              </div>
                              <div class="stat-box">
                                        <div class="number">{{ stats.cancelled }}</div>
                                        <div class="label">Cancelled</div>
                              </div>
                    </div>
          </div>

          <!-- Registrations Table -->
          <div class="table-container">
                    <table class="table is-fullwidth is-hoverable">
                              <thead>
                                        <tr>
                                                  <th>ID</th>
                                                  <th>Member</th>
                                                  <th>Email</th>
                                                  <th>Organization</th>
                                                  <th>Registration Date</th>
                                                  <th>Status</th>
                                                  <th>Attendance</th>
                                                  <th>Actions</th>
                                        </tr>
                              </thead>
                              <tbody>
                                        {% if registrations %}
                                        {% for reg in registrations %}
                                        <tr>
                                                  <td>{{ reg.id }}</td>
                                                  <td>
                                                            <div><strong>{{ reg.member.full_name_en or
                                                                                reg.member.username }}</strong></div>
                                                            {% if reg.member.full_name_th %}
                                                            <div class="is-size-7 has-text-grey">{{
                                                                      reg.member.full_name_th }}</div>
                                                            {% endif %}
                                                  </td>
                                                  <td>{{ reg.member.email }}</td>
                                                  <td>
                                                            <span class="is-size-7">
                                                                      {{ reg.member.organization.name[:40] if
                                                                      reg.member.organization else '-' }}
                                                            </span>
                                                  </td>
                                                  <td>{{ reg.registration_date.strftime('%Y-%m-%d %H:%M') if
                                                            reg.registration_date else '-' }}</td>
                                                  <td>
                                                            {% if reg.status_ref %}
                                                            {% set status_lower = reg.status_ref.name_en.lower() %}
                                                            <span
                                                                      class="tag {% if status_lower == 'confirmed' %}is-success{% elif status_lower == 'pending' %}is-warning{% elif status_lower == 'cancelled' %}is-danger{% else %}is-light{% endif %}">
                                                                      {{ reg.status_ref.name_en }}
                                                            </span>
                                                            {% else %}
                                                            <span class="tag">Unknown</span>
                                                            {% endif %}
                                                  </td>
                                                  <td>
                                                            <div class="is-size-7">
                                                                      <div><i class="fas fa-check-circle"></i> {{
                                                                                reg.attendance_count or 0 }}</div>
                                                                      <div><i class="fas fa-clock"></i> {{
                                                                                reg.total_hours_attended or 0 }}h</div>
                                                            </div>
                                                  </td>
                                                  <td>
                                                            <div class="buttons">
                                                                      <a href="{{ url_for('continuing_edu_admin.view_registration', registration_id=reg.id) }}"
                                                                                class="button is-small is-info"
                                                                                title="View Details">
                                                                                <span class="icon"><i
                                                                                                    class="fas fa-eye"></i></span>
                                                                      </a>
                                                            </div>
                                                  </td>
                                        </tr>
                                        {% endfor %}
                                        {% else %}
                                        <tr>
                                                  <td colspan="8" class="has-text-centered has-text-grey">
                                                            <div class="py-6">
                                                                      <span class="icon is-large">
                                                                                <i class="fas fa-inbox fa-3x"></i>
                                                                      </span>
                                                                      <p class="mt-3">No registrations for this event
                                                                                yet</p>
                                                            </div>
                                                  </td>
                                        </tr>
                                        {% endif %}
                              </tbody>
                    </table>
          </div>

          <!-- Pagination -->
          {% if pagination.pages > 1 %}
          <nav class="pagination is-centered mt-5" role="navigation" aria-label="pagination">
                    <a class="pagination-previous" {% if pagination.has_prev %}
                              href="{{ url_for('continuing_edu_admin.event_registrations', event_id=event.id, page=pagination.prev_num) }}"
                              {% else %} disabled {% endif %}>
                              Previous
                    </a>
                    <a class="pagination-next" {% if pagination.has_next %}
                              href="{{ url_for('continuing_edu_admin.event_registrations', event_id=event.id, page=pagination.next_num) }}"
                              {% else %} disabled {% endif %}>
                              Next page
                    </a>
                    <ul class="pagination-list">
                              {% for page_num in pagination.iter_pages(left_edge=1, right_edge=1, left_current=2,
                              right_current=2) %}
                              {% if page_num %}
                              <li>
                                        <a class="pagination-link {% if page_num == pagination.page %}is-current{% endif %}"
                                                  href="{{ url_for('continuing_edu_admin.event_registrations', event_id=event.id, page=page_num) }}">
                                                  {{ page_num }}
                                        </a>
                              </li>
                              {% else %}
                              <li><span class="pagination-ellipsis">&hellip;</span></li>
                              {% endif %}
                              {% endfor %}
                    </ul>
          </nav>
          {% endif %}
</div>
{% endblock %}