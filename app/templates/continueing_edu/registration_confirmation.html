{% extends "continueing_edu/base_frontend.html" %}

{% block title %}{{ texts.get('university_name', 'มหาวิทยาลัยมหิดล') }} - Registration Confirmation{% endblock %}

{% block extra_css %}
{{ super() }}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<style>
          body {
                    font-family: 'Inter', sans-serif;
                    background-color: #f8fafc;
          }

          .rounded-lg {
                    border-radius: 0.5rem;
          }

          .shadow-sm {
                    box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
          }

          .shadow-lg {
                    box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
          }

          .has-text-gray-600 {
                    color: #4b5563;
          }

          .has-text-gray-800 {
                    color: #1f2937;
          }

          .has-background-indigo-700 {
                    background-color: #4338ca;
          }

          .hover\:has-background-indigo-800:hover {
                    background-color: #3730a3;
          }

          .university-logo {
                    max-height: 2.5rem;
                    margin-right: 0.5rem;
                    width: auto;
          }

          .language-button {
                    margin-left: 0.5rem;
                    min-width: 40px;
                    text-align: center;
          }

          .language-button.is-active {
                    background-color: #4338ca;
                    color: white;
                    border-color: #4338ca;
          }

          .language-button:not(.is-active) {
                    background-color: #e0e7ff;
                    color: #4338ca;
                    border-color: #e0e7ff;
          }

          /* Page Title */
          .page-title {
                    font-size: 2rem;
                    font-weight: 700;
                    color: #1f2937;
                    margin-bottom: 2rem;
                    padding-bottom: 1rem;
                    border-bottom: 2px solid #e5e7eb;
          }

          /* Course Info Card */
          .info-card {
                    background: white;
                    border-radius: 0.5rem;
                    padding: 1.5rem;
                    box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
                    margin-bottom: 1.5rem;
          }

          .course-image {
                    border-radius: 0.5rem;
                    overflow: hidden;
                    margin-bottom: 1rem;
          }

          .course-image img {
                    width: 100%;
                    height: 250px;
                    object-fit: cover;
          }

          /* Summary Card */
          .summary-card {
                    background: white;
                    border-radius: 0.5rem;
                    padding: 1.5rem;
                    box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
                    position: sticky;
                    top: 2rem;
          }

          .summary-row {
                    display: flex;
                    justify-content: space-between;
                    padding: 0.75rem 0;
                    border-bottom: 1px solid #f3f4f6;
          }

          .summary-row:last-child {
                    border-bottom: none;
          }

          .summary-total {
                    border-top: 2px solid #4338ca;
                    margin-top: 1rem;
                    padding-top: 1rem;
                    font-size: 1.25rem;
                    font-weight: 700;
                    color: #4338ca;
          }

          /* Buttons */
          .btn-confirm {
                    background: linear-gradient(135deg, #4338ca 0%, #6366f1 100%);
                    color: white;
                    border: none;
                    padding: 0.75rem 2rem;
                    border-radius: 0.5rem;
                    font-weight: 600;
                    cursor: pointer;
                    transition: all 0.3s;
                    width: 100%;
          }

          .btn-confirm:hover {
                    transform: translateY(-2px);
                    box-shadow: 0 4px 12px rgba(67, 56, 202, 0.4);
          }

          .btn-back {
                    background: white;
                    color: #4b5563;
                    border: 1px solid #d1d5db;
                    padding: 0.75rem 2rem;
                    border-radius: 0.5rem;
                    font-weight: 600;
                    cursor: pointer;
                    transition: all 0.3s;
                    width: 100%;
                    text-align: center;
                    display: inline-block;
          }

          .btn-back:hover {
                    background: #f9fafb;
                    border-color: #9ca3af;
          }

          /* Info Table */
          .info-table td {
                    padding: 0.75rem;
                    border-bottom: 1px solid #f3f4f6;
          }

          .info-table tr:last-child td {
                    border-bottom: none;
          }

          /* Checkbox */
          .checkbox-wrapper {
                    display: flex;
                    align-items: flex-start;
                    padding: 1rem;
                    background: #f9fafb;
                    border-radius: 0.5rem;
                    border: 1px solid #e5e7eb;
                    margin-bottom: 1rem;
          }

          .checkbox-wrapper input[type="checkbox"] {
                    margin-right: 0.75rem;
                    margin-top: 0.25rem;
          }

          /* Member Type Badge */
          .member-badge {
                    display: inline-flex;
                    align-items: center;
                    padding: 0.5rem 1rem;
                    background: #ede9fe;
                    color: #5b21b6;
                    border-radius: 0.375rem;
                    font-weight: 600;
                    margin-bottom: 1rem;
          }

          /* Responsive */
          @media screen and (max-width: 768px) {
                    .summary-card {
                              position: relative;
                              top: 0;
                              margin-top: 1.5rem;
                    }

                    .course-image img {
                              height: 200px;
                    }
          }
</style>
{% endblock %}

{% block content %}
<!-- Header (Same as course_detail) -->
<!-- <header class="navbar has-background-white shadow-sm py-4">
                    <div
                              class="container is-fluid is-flex is-flex-direction-column is-flex-direction-row-desktop is-justify-content-space-between is-align-items-center">
                              <div class="navbar-brand">
                                        <a href="{{ url_for('continuing_edu.index', lang=current_lang) }}"
                                                  class="navbar-item">
                                                  <img src="https://placehold.co/100x40/4338CA/FFFFFF?text=LOGO"
                                                            alt="University Logo" class="university-logo">
                                        </a>
                                        <div class="navbar-burger burger" data-target="navbarMenu">
                                                  <span></span>
                                                  <span></span>
                                                  <span></span>
                                        </div>
                              </div>
                              <div id="navbarMenu" class="navbar-menu">
                                        <div class="navbar-end mt-4-mobile mt-0-desktop">
                                                  <a href="{{ url_for('continuing_edu.index', lang=current_lang) }}#short-courses"
                                                            class="navbar-item has-text-gray-600 hover:has-text-indigo-700 has-text-weight-medium rounded-md">
                                                            {{ texts.get('short_courses_nav', 'Short Courses' if
                                                            current_lang == 'en' else 'หลักสูตรระยะสั้น') }}
                                                  </a>
                                                  <a href="{{ url_for('continuing_edu.index', lang=current_lang) }}#webinars"
                                                            class="navbar-item has-text-gray-600 hover:has-text-indigo-700 has-text-weight-medium rounded-md">
                                                            {{ texts.get('webinars_nav', 'Webinars' if current_lang ==
                                                            'en' else 'สัมมนา') }}
                                                  </a>
                                                  <a href="{{ url_for('continuing_edu.login', lang=current_lang) }}"
                                                            class="navbar-item has-text-gray-600 hover:has-text-indigo-700 has-text-weight-medium rounded-md">
                                                            <i class="fas fa-user-circle mr-2"></i>
                                                            {{ texts.get('login_nav', 'Login' if current_lang == 'en'
                                                            else 'เข้าสู่ระบบ') }}
                                                  </a>
                                                  <div class="navbar-item">
                                                            <div class="buttons">
                                                                      <a href="{{ url_for('continuing_edu.register_event', event_id=event.id, lang='th') }}"
                                                                                class="button language-button is-small {% if current_lang == 'th' %}is-active{% endif %}">TH</a>
                                                                      <a href="{{ url_for('continuing_edu.register_event', event_id=event.id, lang='en') }}"
                                                                                class="button language-button is-small {% if current_lang == 'en' %}is-active{% endif %}">EN</a>
                                                            </div>
                                                  </div>
                                        </div>
                              </div>
                    </div>
          </header> -->

<!-- Main Content -->
<section class="section" style="padding-top: 3rem; padding-bottom: 4rem;">
          <div class="container">
                    <!-- Page Title -->
                    <h1 class="page-title">
                              <i class="fas fa-clipboard-check mr-3"></i>
                              {{ texts.get('registration_confirmation', 'Registration Confirmation' if
                              current_lang == 'en' else 'ยืนยันการลงทะเบียน') }}
                    </h1>

                    <div class="columns">
                              <!-- Left Column: Course/Webinar Information -->
                              <div class="column is-8">
                                        <!-- Course/Webinar Info Card -->
                                        <div class="info-card">
                                                  <h2 class="title is-4 mb-4">
                                                            <i class="fas fa-info-circle has-text-info mr-2"></i>
                                                            {{ texts.get('event_information', 'Event
                                                            Information' if current_lang == 'en' else
                                                            'ข้อมูลหลักสูตร/สัมมนา') }}
                                                  </h2>

                                                  <!-- Event Image -->
                                                  {% set cover = event.cover_presigned_url() or
                                                  event.poster_presigned_url() or event.image_url or
                                                  url_for('static', filename='img/LOGO_MT-Mahidol.png') %}
                                                  <div class="course-image">
                                                            <img src="{{ cover }}"
                                                                      alt="{{ event.title_en or event.title_th }}">
                                                  </div>

                                                  <!-- Event Type Badge -->
                                                  <div class="mb-3">
                                                            {% if event.event_type == 'course' %}
                                                            <span class="tag is-info is-medium">
                                                                      <i class="fas fa-graduation-cap mr-2"></i>
                                                                      {{ texts.get('course', 'Course' if
                                                                      current_lang == 'en' else 'หลักสูตร') }}
                                                            </span>
                                                            {% else %}
                                                            <span class="tag is-link is-medium">
                                                                      <i class="fas fa-video mr-2"></i>
                                                                      {{ texts.get('webinar', 'Webinar' if
                                                                      current_lang == 'en' else 'สัมมนา') }}
                                                            </span>
                                                            {% endif %}
                                                  </div>

                                                  <!-- Event Title -->
                                                  <h3 class="title is-3 mb-3">
                                                            {{ event.title_th if current_lang == 'th' else
                                                            event.title_en }}
                                                  </h3>

                                                  <!-- Event Description -->
                                                  {% if event.description_th or event.description_en %}
                                                  <div class="content mb-4">
                                                            <p class="has-text-grey-dark">
                                                                      {{ event.description_th if current_lang
                                                                      == 'th' else event.description_en }}
                                                            </p>
                                                  </div>
                                                  {% endif %}

                                                  <!-- Event Details Table -->
                                                  <table class="table is-fullwidth info-table">
                                                            <tbody>
                                                                      {% if event.start_time %}
                                                                      <tr>
                                                                                <td style="width: 30%;">
                                                                                          <strong>
                                                                                                    <i
                                                                                                              class="fas fa-calendar-alt has-text-info mr-2"></i>
                                                                                                    {{
                                                                                                    texts.get('event_date',
                                                                                                    'Event
                                                                                                    Date' if
                                                                                                    current_lang
                                                                                                    == 'en'
                                                                                                    else
                                                                                                    'วันที่จัด')
                                                                                                    }}
                                                                                          </strong>
                                                                                </td>
                                                                                <td>
                                                                                          {{
                                                                                          event.start_time.strftime('%d/%m/%Y')
                                                                                          }}
                                                                                          {% if event.end_time
                                                                                          and event.end_time
                                                                                          != event.start_time
                                                                                          %}
                                                                                          - {{
                                                                                          event.end_time.strftime('%d/%m/%Y')
                                                                                          }}
                                                                                          {% endif %}
                                                                                </td>
                                                                      </tr>
                                                                      {% endif %}
                                                                      {% if event.start_time and
                                                                      event.end_time %}
                                                                      <tr>
                                                                                <td>
                                                                                          <strong>
                                                                                                    <i
                                                                                                              class="fas fa-clock has-text-info mr-2"></i>
                                                                                                    {{
                                                                                                    texts.get('event_time',
                                                                                                    'Time' if
                                                                                                    current_lang
                                                                                                    == 'en'
                                                                                                    else
                                                                                                    'เวลา') }}
                                                                                          </strong>
                                                                                </td>
                                                                                <td>
                                                                                          {{
                                                                                          event.start_time.strftime('%H:%M')
                                                                                          }} - {{
                                                                                          event.end_time.strftime('%H:%M')
                                                                                          }}
                                                                                </td>
                                                                      </tr>
                                                                      {% endif %}
                                                            </tbody>
                                                  </table>
                                        </div>

                                        <!-- Member Information Card -->
                                        <div class="info-card">
                                                  <h2 class="title is-4 mb-4">
                                                            <i class="fas fa-user-circle has-text-link mr-2"></i>
                                                            {{ texts.get('your_information', 'Your
                                                            Information' if current_lang == 'en' else
                                                            'ข้อมูลของคุณ') }}
                                                  </h2>

                                                  <table class="table is-fullwidth info-table">
                                                            <tbody>
                                                                      <tr>
                                                                                <td style="width: 30%;">
                                                                                          <strong>
                                                                                                    <i
                                                                                                              class="fas fa-user has-text-link mr-2"></i>
                                                                                                    {{
                                                                                                    texts.get('name',
                                                                                                    'Name' if
                                                                                                    current_lang
                                                                                                    == 'en'
                                                                                                    else
                                                                                                    'ชื่อ') }}
                                                                                          </strong>
                                                                                </td>
                                                                                <td>{{ member.full_name_th if
                                                                                          current_lang == 'th'
                                                                                          else
                                                                                          member.full_name_en
                                                                                          }}</td>
                                                                      </tr>
                                                                      <tr>
                                                                                <td>
                                                                                          <strong>
                                                                                                    <i
                                                                                                              class="fas fa-envelope has-text-link mr-2"></i>
                                                                                                    {{
                                                                                                    texts.get('email',
                                                                                                    'Email' if
                                                                                                    current_lang
                                                                                                    == 'en'
                                                                                                    else
                                                                                                    'อีเมล')
                                                                                                    }}
                                                                                          </strong>
                                                                                </td>
                                                                                <td>{{ member.email }}</td>
                                                                      </tr>
                                                                      {% if member.phone_no %}
                                                                      <tr>
                                                                                <td>
                                                                                          <strong>
                                                                                                    <i
                                                                                                              class="fas fa-phone has-text-link mr-2"></i>
                                                                                                    {{
                                                                                                    texts.get('phone',
                                                                                                    'Phone' if
                                                                                                    current_lang
                                                                                                    == 'en'
                                                                                                    else
                                                                                                    'เบอร์โทร')
                                                                                                    }}
                                                                                          </strong>
                                                                                </td>
                                                                                <td>{{ member.phone_no }}</td>
                                                                      </tr>
                                                                      {% endif %}
                                                            </tbody>
                                                  </table>
                                        </div>

                                        <!-- Terms & Conditions -->
                                        <form method="POST"
                                                  action="{{ url_for('continuing_edu.confirm_registration', event_id=event.id, lang=current_lang) }}"
                                                  id="confirmForm">
                                                  <div class="info-card">
                                                            <div class="checkbox-wrapper">
                                                                      <input type="checkbox" name="terms_accepted"
                                                                                id="terms_accepted" required>
                                                                      <label for="terms_accepted">
                                                                                <strong>
                                                                                          {{
                                                                                          texts.get('accept_terms',
                                                                                          'I have read and
                                                                                          accept the
                                                                                          registration terms
                                                                                          and conditions' if
                                                                                          current_lang == 'en'
                                                                                          else
                                                                                          'ฉันได้อ่านและยอมรับเงื่อนไขการลงทะเบียน')
                                                                                          }}
                                                                                </strong>
                                                                      </label>
                                                            </div>

                                                            <!-- Action Buttons -->
                                                            <div class="columns">
                                                                      <div class="column is-6">
                                                                                {% if event.event_type ==
                                                                                'course' %}
                                                                                <a href="{{ url_for('continuing_edu.course_detail', course_id=event.id, lang=current_lang) }}"
                                                                                          class="btn-back">
                                                                                          {% else %}
                                                                                          <a href="{{ url_for('continuing_edu.webinar_detail', webinar_id=event.id, lang=current_lang) }}"
                                                                                                    class="btn-back">
                                                                                                    {% endif
                                                                                                    %}
                                                                                                    <i
                                                                                                              class="fas fa-arrow-left mr-2"></i>
                                                                                                    {{
                                                                                                    texts.get('back',
                                                                                                    'Back' if
                                                                                                    current_lang
                                                                                                    == 'en'
                                                                                                    else
                                                                                                    'ย้อนกลับ')
                                                                                                    }}
                                                                                          </a>
                                                                      </div>
                                                                      <div class="column is-6">
                                                                                <button type="submit"
                                                                                          class="btn-confirm"
                                                                                          id="confirmBtn">
                                                                                          <i
                                                                                                    class="fas fa-check-circle mr-2"></i>
                                                                                          {{
                                                                                          texts.get('confirm_register',
                                                                                          'Confirm
                                                                                          Registration' if
                                                                                          current_lang == 'en'
                                                                                          else
                                                                                          'ยืนยันการลงทะเบียน')
                                                                                          }}
                                                                                </button>
                                                                      </div>
                                                            </div>

                                                            <div class="has-text-centered mt-4">
                                                                      <p class="has-text-grey is-size-7">
                                                                                <i class="fas fa-shield-alt mr-1"></i>
                                                                                {{ texts.get('secure_info',
                                                                                'Your information is secure
                                                                                and encrypted' if current_lang
                                                                                == 'en' else
                                                                                'ข้อมูลของคุณปลอดภัยและเข้ารหัส')
                                                                                }}
                                                                      </p>
                                                            </div>
                                                  </div>
                                        </form>
                              </div>

                              <!-- Right Column: Price Summary -->
                              <div class="column is-4">
                                        <div class="summary-card">
                                                  <h2 class="title is-5 mb-4">
                                                            <i class="fas fa-receipt has-text-info mr-2"></i>
                                                            {{ texts.get('payment_summary', 'Payment Summary'
                                                            if current_lang == 'en' else 'สรุปยอดชำระ') }}
                                                  </h2>

                                                  <!-- Member Type -->
                                                  <div class="member-badge">
                                                            <i class="fas fa-user-tag mr-2"></i>
                                                            {{ fee.member_type_ref.name_th if current_lang ==
                                                            'th' else fee.member_type_ref.name_en }}
                                                  </div>

                                                  <!-- Price Breakdown -->
                                                  <div class="summary-row">
                                                            <span class="has-text-grey">{{
                                                                      texts.get('subtotal', 'Subtotal' if
                                                                      current_lang == 'en' else 'ยอดรวม')
                                                                      }}</span>
                                                            <span class="has-text-weight-semibold">฿{{
                                                                      "{:,.2f}".format(fee.price) }}</span>
                                                  </div>

                                                  {% if is_early_bird and fee.early_bird_price and
                                                  fee.early_bird_price < fee.price %} <div class="summary-row">
                                                            <span class="has-text-success">
                                                                      <i class="fas fa-bolt mr-1"></i>
                                                                      {{ texts.get('early_bird_discount',
                                                                      'Early Bird Discount' if current_lang ==
                                                                      'en' else 'ส่วนลด Early Bird') }}
                                                            </span>
                                                            <span class="has-text-success has-text-weight-semibold">-฿{{
                                                                      "{:,.2f}".format(fee.price -
                                                                      fee.early_bird_price) }}</span>
                                        </div>
                                        {% endif %}

                                        <div class="summary-row summary-total">
                                                  <span>{{ texts.get('total_payment', 'Total Payment' if
                                                            current_lang == 'en' else 'ยอดชำระทั้งหมด')
                                                            }}</span>
                                                  <span>฿{{ "{:,.2f}".format(price) }}</span>
                                        </div>

                                        <!-- Secure Badge -->
                                        <div class="notification is-light is-success mt-4">
                                                  <div class="has-text-centered">
                                                            <i class="fas fa-lock has-text-success is-size-4 mb-2"></i>
                                                            <p class="has-text-weight-semibold has-text-success">
                                                                      {{ texts.get('secure_payment', 'Secure
                                                                      Payment' if current_lang == 'en' else
                                                                      'ชำระเงินปลอดภัย') }}
                                                            </p>
                                                  </div>
                                        </div>

                                        <!-- Next Steps -->
                                        <div class="notification is-light is-info mt-3">
                                                  <p class="has-text-weight-semibold mb-2">
                                                            <i class="fas fa-info-circle mr-2"></i>
                                                            {{ texts.get('next_steps', 'Next Steps' if
                                                            current_lang == 'en' else 'ขั้นตอนต่อไป') }}
                                                  </p>
                                                  <p class="is-size-7">
                                                            {{ texts.get('payment_instruction', 'After
                                                            confirmation, you will be redirected to the
                                                            payment page to complete your registration.' if
                                                            current_lang == 'en' else 'หลังจากยืนยัน
                                                            คุณจะถูกนำไปยังหน้าชำระเงินเพื่อดำเนินการลงทะเบียนให้เสร็จสมบูรณ์')
                                                            }}
                                                  </p>
                                        </div>
                              </div>
                    </div>
          </div>
          </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
          // Navbar burger toggle
          document.addEventListener('DOMContentLoaded', () => {
                    const $navbarBurgers = Array.prototype.slice.call(document.querySelectorAll('.navbar-burger'), 0);
                    if ($navbarBurgers.length > 0) {
                              $navbarBurgers.forEach(el => {
                                        el.addEventListener('click', () => {
                                                  const target = el.dataset.target;
                                                  const $target = document.getElementById(target);
                                                  el.classList.toggle('is-active');
                                                  $target.classList.toggle('is-active');
                                        });
                              });
                    }

                    // Form submission with loading state
                    const form = document.getElementById('confirmForm');
                    const btn = document.getElementById('confirmBtn');

                    if (form && btn) {
                              form.addEventListener('submit', function (e) {
                                        btn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>' +
                                                  (document.documentElement.lang === 'th' ? 'กำลังดำเนินการ...' : 'Processing...');
                                        btn.disabled = true;
                              });
                    }
          });
</script>
{% endblock %}