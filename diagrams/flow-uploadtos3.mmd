flowchart TD
    A(เริ่มต้น) --> B{รับข้อมูลจากสองแหล่ง}
    B --> C1[ไฟล์เก็บเป็น Base64 ใน PostgreSQL]
    B --> C2[ไฟล์จากผู้ใช้งานผ่านเว็บแอป]
    C1 --> D1[แปลง Base64 กลับเป็นไฟล์]
    C2 --> D2[นำไฟล์จากผู้ใช้งาน]
    D1 --> E[เตรียมไฟล์เพื่ออัปโหลด]
    D2 --> E
    E --> F[อัปโหลดไฟล์ไปยัง AWS S3]
    F --> G{การอัปโหลดสำเร็จหรือไม่}
    G --> H1[สำเร็จ]
    G --> H2[ล้มเหลว]
    H1 --> I[เก็บ URL ไฟล์จาก S3 ใน PostgreSQL]
    H2 --> J[แจ้งเตือนข้อผิดพลาด]
    I --> K{ไฟล์เดิมเป็น Base64 หรือไม่}
    K --> L1[ลบ Base64 ออกจากฐานข้อมูล]
    K --> L2[ไม่ต้องลบ]
    L1 --> M[สิ้นสุด]
    L2 --> M
    J --> M